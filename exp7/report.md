# 单机性能优化小作业 实验报告 

## 测试结果

#### 任务零：观察不同的编译参数对性能的影响

| 编译器参数 | 用时 (sec) | 性能 (GFlop/s) | 加速比 |
| ---------- | ---------- | -------------- | ------ |
| `-O0`      | 0.9993     | 0.2686         | 1      |
| `-O1`      | 0.3424     | 0.7840         | 2.92   |
| `-O2`      | 0.3291     | 0.8157         | 3.04   |
| `-O3`      | 0.0514     | 5.2175         | 19.09  |
| `-fast`    | 0.0393     | 6.8361         | 25.45  |

#### 任务一：观察向量指令和循环展开对性能的影响

| 循环展开程度 | 用时 (sec) | 性能 (GFlop/s) | 加速比 |
| ------------ | ---------- | -------------- | ------ |
| 1            | 2.0650     | 15.8686        | 1      |
| 2            | 1.9303     | 16.9754        | 1.070  |
| 4            | 1.8054     | 18.1502        | 1.144  |
| 8            | 1.7776     | 18.4334        | 1.162  |
| 16           | 1.8286     | 17.9199        | 1.129  |
| 32           | 1.9082     | 17.1726        | 1.082  |
| 64           | 2.1980     | 14.9079        | 0.939  |

> 为什么这里循环展开程度为16（及以上）时，用时反而变大了？是因为储存指令的开销变得过大了吗？

## 回答问题

1. 请参考 [ICC 手册](https://www.intel.com/content/www/us/en/develop/documentation/cpp-compiler-developer-guide-and-reference/top/compiler-reference/compiler-options/alphabetical-list-of-compiler-options.html) 并简述参数 (`-O0`, `-O1`, `-O2`, `-O3`, `-fast`) 分别进行了哪些编译优化。每种参数罗列几个优化技术即可。

   - `-O0`：无优化
   - `-O1`：在不增加代码量的前提下进行优化，包括数据依赖分析、代码移动、强度拆减等
   - `-O2`：常见的优化选项，在`O1`基础上包括内联、常数折叠、复制传播、死代码消除等
   - `-O3`：在`O2`基础上进行浮点计算和循环相关优化，包括循环融合、合并分支判断等
   - `-fast`：在`O3`基础上进行智能优化，等价于`-ipo, -O3, -static, -fp-model fast=2`

2. 请简述任务一中循环展开带来的好处。

   答：循环展开减少了循环变量`K`的比较次数，减少了计算量；同时减少了执行分支跳转指令的次数，有利于实现流水线更高的吞吐量。